local Rayfield = loadstring(game:HttpGet('https://raw.githubusercontent.com/shlexware/Rayfield/main/source'))()

local Window = Rayfield:CreateWindow({
   Name = "Merara hub",
   LoadingTitle = "カ。慣性の法則について。",
   LoadingSubtitle = "by Merara!!",
   ConfigurationSaving = {
      Enabled = false
   }
})

local Tab = Window:CreateTab("Movement")
local Section = Tab:CreateSection("Inertia Control")

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer

local function WaitForChar()
	local char = player.Character or player.CharacterAdded:Wait()
	local root = char:WaitForChild("HumanoidRootPart")
	local humanoid = char:WaitForChild("Humanoid")
	return char, root, humanoid
end

local char, root, humanoid = WaitForChar()

local BRAKE_POWER = 8
local BrakeConnection = nil
local Enabled = false

local function EnableBrake()
	if BrakeConnection then return end
	
	BrakeConnection = RunService.RenderStepped:Connect(function(dt)
		local vel = root.AssemblyLinearVelocity
		local moving = humanoid.MoveDirection.Magnitude > 0
		if not moving then
			root.AssemblyLinearVelocity = vel * math.clamp(1 - (BRAKE_POWER * dt), 0, 1)
		end
	end)
end

local function DisableBrake()
	if BrakeConnection then
		BrakeConnection:Disconnect()
		BrakeConnection = nil
	end
end

local Toggle = Tab:CreateToggle({
   Name = "慣性を無効化（ONでピタッと止まる）",
   CurrentValue = false,
   Flag = "InertiaToggle",
   Callback = function(Value)
        Enabled = Value
        if Enabled then
            EnableBrake()
        else
            DisableBrake()
        end
   end,
})

local Slider = Tab:CreateSlider({
    Name = "ブレーキ強度",
    Range = {1, 20},
    Increment = 1,
    Suffix = " Power",
    CurrentValue = BRAKE_POWER,
    Flag = "BrakeSlider",
    Callback = function(Value)
        BRAKE_POWER = Value
    end,
})

player.CharacterAdded:Connect(function()
	char, root, humanoid = WaitForChar()
	if Enabled then
		EnableBrake()
	end
end)
